<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‡¼ì¸ ê³µì¥ - AI ì´ë¯¸ì§€ ì‡¼ì¸ </title>
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="stylesheet" href="/css/toss-style.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        /* JSON ì…ë ¥ */
        .json-editor {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            border: 1px solid var(--color-gray-300);
            border-radius: 8px;
            font-size: 0.85rem;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.5;
            resize: vertical;
            background: var(--color-bg-tertiary);
            color: var(--color-gray-900);
        }

        .json-editor:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(77, 158, 255, 0.15);
        }

        /* ì„¤ì • */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .setting-item label {
            font-size: 0.8rem;
            color: var(--color-gray-600);
            font-weight: 500;
        }

        .setting-item input,
        .setting-item select {
            padding: 0.6rem 0.75rem;
            border: 1px solid var(--color-gray-300);
            border-radius: 6px;
            font-size: 0.85rem;
            background: var(--color-bg-tertiary);
            color: var(--color-gray-900);
        }

        /* ë²„íŠ¼ */
        .actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary {
            background: var(--color-gray-100);
            color: var(--color-gray-700);
        }

        .btn-secondary:hover {
            background: var(--color-gray-200);
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ë„ì›€ë§ */
        .help-box {
            background: var(--color-gray-50);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .help-box h4 {
            font-size: 0.85rem;
            color: var(--color-gray-800);
            margin-bottom: 0.5rem;
        }

        .help-box pre {
            background: var(--color-bg-tertiary);
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.75rem;
            overflow-x: auto;
            color: var(--color-gray-300);
        }

        .help-box p {
            font-size: 0.8rem;
            color: var(--color-gray-600);
            margin-top: 0.5rem;
        }

        /* ì§„í–‰ ìƒíƒœ */
        .progress-section {
            display: none;
        }

        .progress-section.active {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .progress-bar-container {
            background: var(--color-gray-200);
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            background: var(--color-primary);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .progress-status {
            font-size: 0.85rem;
            color: var(--color-gray-600);
            text-align: center;
        }

        .progress-log {
            background: var(--color-bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            max-height: 100px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.75rem;
            color: var(--color-gray-500);
            margin-top: 1rem;
        }

        .progress-log .log-item {
            padding: 0.25rem 0;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .progress-log .log-item:last-child {
            border-bottom: none;
        }

        .progress-log .success {
            color: var(--color-success);
        }

        .progress-log .error {
            color: var(--color-error);
        }

        /* ê²°ê³¼ */
        .result-section {
            display: none;
        }

        .result-section.active {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .result-video {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: block;
            border-radius: 12px;
            background: #000;
        }

        .result-info {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--color-gray-50);
            border-radius: 8px;
        }

        .result-info p {
            font-size: 0.85rem;
            color: var(--color-gray-600);
            margin: 0.25rem 0;
        }

        .result-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* ë¡œë”© */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* í…œí”Œë¦¿ ë²„íŠ¼ */
        .template-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .template-btn {
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--color-gray-300);
            background: var(--color-bg-elevated);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--color-gray-600);
            cursor: pointer;
            transition: all 0.15s;
        }

        .template-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        /* Mini Player Styles */
        .mini-player {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--color-bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--color-gray-200);
        }

        .mini-player-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--color-gray-300);
            background: var(--color-bg-secondary);
            color: var(--color-gray-500);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
            padding: 0;
        }

        .mini-player-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            transform: scale(1.08);
        }

        .mini-player-btn:active {
            transform: scale(0.95);
        }

        .mini-player-btn.playing {
            border-color: var(--color-primary);
            color: var(--color-primary);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            }

            50% {
                box-shadow: 0 0 0 6px rgba(59, 130, 246, 0);
            }
        }

        .mini-player-btn svg {
            width: 14px;
            height: 14px;
        }

        .mini-player-info {
            flex: 1;
            min-width: 0;
        }

        .mini-player-progress {
            height: 4px;
            background: var(--color-gray-200);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .mini-player-progress-bar {
            height: 100%;
            background: var(--color-primary);
            width: 0%;
            transition: width 0.1s linear;
            border-radius: 2px;
        }

        .mini-player-time {
            font-size: 0.7rem;
            color: var(--color-gray-500);
            margin-top: 0.25rem;
            display: block;
        }

        /* í…Œë§ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .theme-btn {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-gray-300);
            background: var(--color-bg-tertiary);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--color-gray-600);
            cursor: pointer;
            transition: all 0.15s;
        }

        .theme-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .theme-btn.active {
            border-color: var(--color-primary);
            background: rgba(59, 130, 246, 0.1);
            color: var(--color-primary);
        }

        .example-card {
            padding: 0.75rem;
            border: 1px solid var(--color-gray-200);
            border-radius: 8px;
            background: var(--color-bg-tertiary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .example-card:hover {
            border-color: var(--color-primary);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
        }

        .example-card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-gray-800);
            margin-bottom: 0.25rem;
        }

        .example-card-preview {
            font-size: 0.75rem;
            color: var(--color-gray-500);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .example-card-duration {
            font-size: 0.7rem;
            color: var(--color-primary);
            margin-top: 0.25rem;
        }

        /* 2ë‹¨ ë ˆì´ì•„ì›ƒ */
        .main-row {
            display: flex;
            gap: 1.5rem;
            width: 100%;
            align-items: stretch;
            /* ë†’ì´ ë™ì¼í•˜ê²Œ ë§ì¶¤ */
        }

        .left-column {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        /* ì„¹ì…˜ ë†’ì´ ì±„ìš°ê¸° */
        .left-column>.section,
        .right-column>#inputSection {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* ëŒ€ë³¸ ìƒì„±ê¸° ë‚´ë¶€ ì»¨í…ì¸  ì±„ìš°ê¸° */
        .left-column #scriptGenContent {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .right-column {
            flex: 1;
            min-width: 0;
        }

        @media (max-width: 900px) {
            .main-row {
                flex-direction: column;
            }

            .left-column {
                position: static;
                width: 100%;
                max-height: none;
            }

            .right-column {
                width: 100%;
                flex: 1;
            }
        }
    </style>
</head>

<body style="visibility: hidden;">
    <!-- Header (injected by header.js) -->
    <div id="header-placeholder"></div>
    <script src="/js/header.js"></script>

    <!-- ì‚¬ìš©ë²• ëª¨ë‹¬ -->
    <div id="guideModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>ğŸ“– ì‚¬ìš©ë²•</h3>
                <button class="modal-close" onclick="closeGuideModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- API í‚¤ ì•ˆë‚´ -->
                <div
                    style="background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #ffc107;">
                    <p style="color: #856404; font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">âš ï¸ ë¨¼ì € 302.AI
                        API í‚¤ê°€ í•„ìš”í•´ìš”!</p>
                    <p style="color: #856404; font-size: 0.85rem; line-height: 1.6;">
                        í•˜ë‚˜ì˜ <strong>302.AI í‚¤</strong>ë¡œ ì´ë¯¸ì§€ ìƒì„±(DALL-E), ìŒì„± ë“± ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.<br>
                        ì˜¤ë¥¸ìª½ ìœ„ ì„¤ì • ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!
                    </p>
                </div>

                <div
                    style="background: var(--color-bg-tertiary); border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem;">
                    <p style="color: var(--color-gray-700); font-size: 0.9rem; line-height: 1.8;">
                        <strong style="color: var(--color-primary);">AI ìˆí¼</strong>ì€ ê¸€ê³¼ ê·¸ë¦¼ ì„¤ëª…ì„ ì…ë ¥í•˜ë©´ AIê°€ ì´ë¯¸ì§€ë¥¼ ê·¸ë¦¬ê³ , ëª©ì†Œë¦¬ë¥¼
                        ì…í˜€ì„œ ì˜ìƒì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤!
                    </p>
                    <div
                        style="margin-top: 1rem; padding: 1rem; background: var(--color-bg-secondary); border-radius: 8px; border-left: 3px solid var(--color-primary);">
                        <p
                            style="color: var(--color-gray-800); font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">
                            3ë‹¨ê³„ë¡œ ë!</p>
                        <p style="color: var(--color-gray-600); font-size: 0.875rem; line-height: 1.8;">
                            1ï¸âƒ£ ì•„ë˜ ë²„íŠ¼ ëˆŒëŸ¬ì„œ ChatGPTë¡œ ì”¬ êµ¬ì„± ë§Œë“¤ê¸°<br>
                            2ï¸âƒ£ ë§Œë“¤ì–´ì§„ ì”¬ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°<br>
                            3ï¸âƒ£ "ìˆí¼ ìƒì„±" ë²„íŠ¼ í´ë¦­!
                        </p>
                    </div>
                </div>
                <div style="background: var(--color-bg-tertiary); border-radius: 8px; padding: 1.25rem;">
                    <h4 style="color: var(--color-gray-900); margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ’¬ AIí•œí…Œ ì”¬ êµ¬ì„±
                        ë§Œë“¤ì–´ë‹¬ë¼ê³  í•˜ê¸°</h4>
                    <p style="color: var(--color-gray-500); font-size: 0.8rem; margin-bottom: 0.75rem;">ChatGPT, Claude,
                        Gemini ë“± ì•„ë¬´ AIë‚˜ ì‚¬ìš© ê°€ëŠ¥!</p>

                    <div style="display: grid; gap: 0.75rem; margin-bottom: 1rem;">
                        <div>
                            <label
                                style="font-size: 0.8rem; color: var(--color-gray-600); margin-bottom: 0.25rem; display: block;">ì£¼ì œ</label>
                            <input type="text" id="promptTopic" placeholder="ì˜ˆ: ê³ ì–‘ì´ì˜ ë¹„ë°€, ëˆ ë²„ëŠ” ìŠµê´€"
                                oninput="updatePromptPreview()"
                                style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-gray-300); border-radius: 6px; font-size: 0.85rem;">
                        </div>
                    </div>

                    <textarea id="promptPreview" readonly
                        style="width: 100%; min-height: 200px; padding: 0.75rem; border: 1px solid var(--color-gray-300); border-radius: 6px; font-size: 0.8rem; font-family: inherit; line-height: 1.6; background: var(--color-bg-secondary); color: var(--color-gray-700); resize: vertical; margin-bottom: 0.75rem;">AIê°€ ê·¸ë¦¼ ê·¸ë¦¬ëŠ” ìœ íŠœë¸Œ ìˆí¼ ë§Œë“¤ì–´ì¤˜

ì£¼ì œ: [ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”]

ì¡°ê±´:
- 3~5ê°œ ì¥ë©´ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
- ê° ì¥ë©´ë§ˆë‹¤ ì½ì„ ëŒ€ì‚¬ ì“°ê¸°
- ê·¸ë¦¼ ì„¤ëª…ì€ ì˜ì–´ë¡œ ìì„¸í•˜ê²Œ

ì´ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜:
[
  {
    "text": "ì²«ë²ˆì§¸ ì¥ë©´ì—ì„œ ì½ì„ ëŒ€ì‚¬",
    "imagePrompt": "first scene image, cinematic, beautiful"
  },
  {
    "text": "ë‘ë²ˆì§¸ ì¥ë©´ ëŒ€ì‚¬",
    "imagePrompt": "second scene description"
  }
]</textarea>

                    <button onclick="copyPromptFromTextarea()"
                        style="width: 100%; background: var(--color-primary); color: white; border: none; padding: 0.75rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer; font-weight: 600;">ğŸ“‹
                        í”„ë¡¬í”„íŠ¸ ë³µì‚¬í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
        <div style="text-align: center; margin-bottom: 2rem;">
            <h1
                style="font-size: 2rem; font-weight: 800; color: var(--color-gray-900); margin-bottom: 0.5rem; letter-spacing: -0.02em;">
                ğŸ¤– AI ì´ë¯¸ì§€ ìˆí¼ ìƒì„±ê¸°
            </h1>
            <p style="color: var(--color-gray-600); font-size: 1rem;">
                ëŒ€ë³¸ ì…ë ¥ â†’ AI ì´ë¯¸ì§€ ìƒì„± â†’ AI ìŒì„± í•©ì„± â†’ ìë™ ìˆí¼ ì™„ì„±
            </p>
        </div>

        <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ (ì¢Œìš° ë°°ì¹˜) -->
        <div class="main-row">
            <!-- ì™¼ìª½: ëŒ€ë³¸ ìƒì„±ê¸° -->
            <div class="left-column">
                <!-- ëŒ€ë³¸ ìƒì„±ê¸° -->
                <div class="section">
                    <!-- OLD Script Gen (Hidden) -->
                    <div style="display:none;">
                        <h2 class="section-title">ğŸ“ ëŒ€ë³¸ ìƒì„±ê¸° (Old)</h2>
                        <div id="scriptGenContent">
                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="font-size: 0.85rem; color: var(--color-gray-600); margin-bottom: 0.5rem; display: block;">í…Œë§ˆ
                                    ì„ íƒ</label>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;" id="themeButtons">
                                    <button type="button" class="theme-btn active" data-theme="story"
                                        onclick="selectTheme('story')">ğŸ“– ìŠ¤í† ë¦¬</button>
                                    <button type="button" class="theme-btn" data-theme="facts"
                                        onclick="selectTheme('facts')">ğŸŒ
                                        ìƒì‹/íŒ©íŠ¸</button>
                                    <button type="button" class="theme-btn" data-theme="motivation"
                                        onclick="selectTheme('motivation')">ğŸ”¥ ë™ê¸°ë¶€ì—¬</button>
                                    <button type="button" class="theme-btn" data-theme="horror"
                                        onclick="selectTheme('horror')">ğŸ‘»
                                        ê³µí¬</button>
                                    <button type="button" class="theme-btn" data-theme="tips"
                                        onclick="selectTheme('tips')">ğŸ’¡
                                        ê¿€íŒ</button>
                                    <button type="button" class="theme-btn" data-theme="korea"
                                        onclick="selectTheme('korea')">ğŸ‡°ğŸ‡·
                                        êµ­ë½•</button>
                                    <button type="button" class="theme-btn" data-theme="international"
                                        onclick="selectTheme('international')">ğŸ’‘ êµ­ê²°</button>
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="font-size: 0.85rem; color: var(--color-gray-600); margin-bottom: 0.5rem; display: block;">ì˜ˆì‹œ
                                    ëŒ€ë³¸ (í´ë¦­í•˜ì—¬ ì ìš©)</label>
                                <div id="exampleScripts" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                </div>
                            </div>
                            <div style="background: var(--color-bg-tertiary); border-radius: 8px; padding: 1rem;">
                                <label
                                    style="font-size: 0.85rem; color: var(--color-gray-600); margin-bottom: 0.5rem; display: block;">AIì—ê²Œ
                                    ëŒ€ë³¸ ìš”ì²­í•˜ê¸°</label>
                                <input type="text" id="customScriptTopic" placeholder="ì£¼ì œ ì…ë ¥ (ì˜ˆ: ìš°ì£¼ì˜ ì‹ ë¹„, ê³ ì–‘ì´ì˜ ë¹„ë°€)"
                                    style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-gray-300); border-radius: 6px; font-size: 0.85rem; margin-bottom: 0.5rem;"
                                    oninput="updateScriptPrompt()">
                                <textarea id="scriptPromptPreview" readonly
                                    style="width: 100%; min-height: 180px; padding: 0.5rem; border: 1px solid var(--color-gray-300); border-radius: 6px; font-size: 0.8rem; font-family: inherit; background: var(--color-bg-secondary); color: var(--color-gray-600); resize: vertical;"></textarea>
                                <button type="button" onclick="copyScriptPrompt()"
                                    style="margin-top: 0.5rem; width: 100%; padding: 0.6rem; background: var(--color-primary); color: white; border: none; border-radius: 6px; font-size: 0.85rem; cursor: pointer; font-weight: 500;">ğŸ“‹
                                    í”„ë¡¬í”„íŠ¸ ë³µì‚¬í•˜ê¸°</button>
                            </div>
                        </div>
                    </div>

                    <!-- NEW Script Gen (from ai-video.html) -->
                    <div class="collapsible-section">
                        <div id="scriptSectionContent">
                            <style>
                                /* Form Layout Styles */
                                .form-grid {
                                    display: flex;
                                    flex-direction: column;
                                    gap: 1.25rem;
                                }

                                .form-row {
                                    display: grid;
                                    gap: 1rem;
                                }

                                .form-row.cols-2 {
                                    grid-template-columns: 1fr 1fr;
                                }

                                .form-row.cols-3 {
                                    grid-template-columns: 1fr 1fr 1fr;
                                }

                                .input-group label {
                                    display: block;
                                    font-size: 0.85rem;
                                    font-weight: 600;
                                    color: var(--color-gray-700);
                                    margin-bottom: 0.4rem;
                                }

                                .input-box {
                                    width: 100%;
                                    padding: 0.6rem 0.75rem;
                                    border: 1px solid var(--color-gray-300);
                                    border-radius: 8px;
                                    font-size: 0.9rem;
                                    background: var(--color-bg-primary);
                                    transition: border-color 0.2s, box-shadow 0.2s;
                                }

                                .input-box:focus {
                                    border-color: var(--color-primary);
                                    outline: none;
                                    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
                                }

                                /* Modern Radio Group */
                                .radio-group-modern {
                                    display: flex;
                                    background: var(--color-bg-tertiary, #f3f4f6);
                                    padding: 4px;
                                    border-radius: 10px;
                                    border: 1px solid var(--color-border);
                                }

                                .radio-option {
                                    flex: 1;
                                    position: relative;
                                }

                                .radio-option input {
                                    position: absolute;
                                    opacity: 0;
                                    cursor: pointer;
                                    width: 100%;
                                    height: 100%;
                                    z-index: 1;
                                }

                                .radio-option span {
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    padding: 0.6rem;
                                    border-radius: 8px;
                                    font-size: 0.9rem;
                                    font-weight: 500;
                                    color: var(--color-text-secondary);
                                    transition: all 0.2s;
                                }

                                .radio-option input:checked+span {
                                    background: var(--color-bg-primary);
                                    color: var(--color-primary);
                                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                                    font-weight: 700;
                                }

                                .helper-text {
                                    margin-top: 0.5rem;
                                    font-size: 0.85rem;
                                    color: var(--color-gray-600);
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                }

                                /* Chips Grid */
                                .style-grid {
                                    display: grid;
                                    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                                    gap: 0.5rem;
                                }

                                .style-option-chip {
                                    padding: 0.5rem;
                                    border: 1px solid var(--color-gray-300);
                                    border-radius: 20px;
                                    background: var(--color-bg-primary);
                                    cursor: pointer;
                                    text-align: center;
                                    font-size: 0.8rem;
                                    transition: all 0.2s;
                                    color: var(--color-gray-600);
                                }

                                .style-option-chip:hover {
                                    border-color: var(--color-primary);
                                    color: var(--color-primary);
                                }

                                .style-option-chip.selected {
                                    border-color: var(--color-primary);
                                    background: rgba(59, 130, 246, 0.1);
                                    color: var(--color-primary);
                                    font-weight: 700;
                                }

                                /* Responsive adjustments */
                                @media (max-width: 800px) {

                                    .form-row.cols-2,
                                    .form-row.cols-3 {
                                        grid-template-columns: 1fr;
                                        gap: 0.75rem;
                                    }
                                }

                                /* Result Styles */
                                .script-result-card {
                                    background: var(--color-bg-secondary);
                                    border: 1px solid var(--color-border);
                                    border-radius: 12px;
                                    padding: 1.25rem;
                                    margin-bottom: 1rem;
                                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                                }

                                .script-result-header {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 0.75rem;
                                    font-weight: 700;
                                    color: var(--color-gray-800);
                                }

                                .audio-player-container {
                                    margin-top: 1rem;
                                    padding-top: 1rem;
                                    border-top: 1px solid var(--color-border);
                                    display: flex;
                                    align-items: center;
                                    gap: 0.75rem;
                                }
                            </style>

                            <div class="form-grid">
                                <!-- Content Mode -->
                                <div class="input-group">
                                    <label>ì½˜í…ì¸  ëª¨ë“œ</label>
                                    <div class="radio-group-modern">
                                        <div class="radio-option">
                                            <input type="radio" name="scriptMode" value="business" checked
                                                onchange="toggleScriptMode()">
                                            <span>ğŸ“¢ ì—…ì²´ í™ë³´í˜•</span>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" name="scriptMode" value="entertainment"
                                                onchange="toggleScriptMode()">
                                            <span>ğŸ­ ì—”í„°í…Œì¸ë¨¼íŠ¸í˜•</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Store & Location Row -->
                                <div class="form-row cols-2">
                                    <div class="input-group">
                                        <label id="labelName">ğŸª ê°€ê²Œ ì´ë¦„</label>
                                        <input type="text" id="storeName" class="input-box"
                                            placeholder="ì˜ˆ: ê³ ì–‘ì‹œ ë§›ì§‘ í• ë§¤ìˆœëŒ€êµ­">
                                        <div class="helper-text">
                                            <label
                                                style="cursor: pointer; display: flex; align-items: center; gap: 0.4rem;">
                                                <input type="checkbox" id="includeName" checked>
                                                ëŒ€ë³¸ì— <span id="labelDetailInclude">ì´ë¦„</span> í¬í•¨
                                            </label>
                                        </div>
                                    </div>
                                    <div class="input-group" id="locationGroup">
                                        <label>ğŸ“ ìœ„ì¹˜ ì •ë³´ (ì„ íƒ)</label>
                                        <input type="text" id="storeLocation" class="input-box" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬">
                                        <div class="helper-text">
                                            <span style="font-weight: 500;">ìœ„ì¹˜ ì–¸ê¸‰:</span>
                                            <label
                                                style="cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                                                <input type="radio" name="locationIn" value="intro" checked> ì¸íŠ¸ë¡œ
                                            </label>
                                            <label
                                                style="cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                                                <input type="radio" name="locationIn" value="outro"> ì•„ì›ƒíŠ¸ë¡œ
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div class="input-group">
                                    <label id="labelDescription">âœï¸ ê°€ê²Œ ì„¤ëª… / íŠ¹ì§•</label>
                                    <textarea id="storeDescription" class="input-box"
                                        style="min-height: 80px; resize: vertical; line-height: 1.6;"
                                        placeholder="40ë…„ ì „í†µì˜ ìˆœëŒ€êµ­ ì „ë¬¸ì ì…ë‹ˆë‹¤. êµ­ë¬¼ì´ ì§„í•˜ê³  ê³ ê¸°ê°€ ë§ì•„ìš”. 24ì‹œê°„ ì˜ì—…í•©ë‹ˆë‹¤."></textarea>
                                </div>

                                <!-- Settings Row: Language, TTS, Filter -->
                                <div class="form-row cols-3">
                                    <div class="input-group">
                                        <label>ğŸ—£ï¸ ì–¸ì–´</label>
                                        <select id="scriptLanguage" class="input-box">
                                            <option value="Korean" selected>Korean</option>
                                            <option value="English">English</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>ğŸ”Š TTS ì„¤ì •</label>
                                        <select id="ttsProvider" class="input-box">
                                            <option value="Google" selected>Google Cloud TTS (ê¸°ë³¸)</option>
                                            <option value="Azure">Azure (ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´)</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>ğŸ¨ ì˜ìƒ í•„í„°</label>
                                        <select id="videoFilter" class="input-box">
                                            <option value="original" selected>ì›ë³¸ (ê¸°ë³¸)</option>
                                            <option value="cinematic">ì‹œë„¤ë§ˆí‹±</option>
                                            <option value="vintage">ë¹ˆí‹°ì§€</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Script Style -->
                                <div class="input-group">
                                    <label>ğŸ¨ ëŒ€ë³¸ ìŠ¤íƒ€ì¼ (ë‹¤ì¤‘ ì„ íƒ)</label>
                                    <div class="style-grid" id="scriptStyleGrid">
                                        <!-- Initial Styles for Business Mode -->
                                        <div class="style-option-chip selected" data-style="Review"
                                            onclick="toggleStyleChip(this)">ë¦¬ë·°í˜•</div>
                                        <div class="style-option-chip selected" data-style="Promotional"
                                            onclick="toggleStyleChip(this)">í™ë³´í˜•</div>
                                        <div class="style-option-chip" data-style="Storytelling"
                                            onclick="toggleStyleChip(this)">ìŠ¤í† ë¦¬í…”ë§í˜•</div>
                                        <div class="style-option-chip" data-style="Tips"
                                            onclick="toggleStyleChip(this)">íŒ/ì¶”ì²œí˜•</div>
                                        <div class="style-option-chip" data-style="Urgency"
                                            onclick="toggleStyleChip(this)">ê¸´ê¸‰/FOMOí˜•</div>
                                        <div class="style-option-chip" data-style="Comparison"
                                            onclick="toggleStyleChip(this)">ë¹„êµí˜•</div>
                                        <div class="style-option-chip" data-style="Question"
                                            onclick="toggleStyleChip(this)">ì§ˆë¬¸í˜•</div>
                                    </div>
                                </div>

                                <!-- Intro/Outro Style -->
                                <div class="form-row cols-2">
                                    <div class="input-group">
                                        <label>ğŸ¬ ì¸íŠ¸ë¡œ ìŠ¤íƒ€ì¼</label>
                                        <select id="introStyle" class="input-box">
                                            <option value="ì§ì„¤ì  ì†Œê°œí˜•">ì§ì„¤ì  ì†Œê°œí˜•</option>
                                            <option value="ì¶©ê²©ì  ì‚¬ì‹¤í˜•">ì¶©ê²©ì  ì‚¬ì‹¤í˜•</option>
                                            <option value="ì§ˆë¬¸ ë˜ì§€ê¸°í˜•">ì§ˆë¬¸ ë˜ì§€ê¸°í˜•</option>
                                            <option value="ë†€ëŒ í›„í¬í˜•">ë†€ëŒ í›„í¬í˜•</option>
                                            <option value="ì§€ì—­ ì¸ì¦í˜•">ì§€ì—­ ì¸ì¦í˜•</option>
                                            <option value="ë°©ë¬¸ ì¸ì¦í˜•" selected>ë°©ë¬¸ ì¸ì¦í˜•</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>ğŸ­ ì•„ì›ƒíŠ¸ë¡œ ìŠ¤íƒ€ì¼</label>
                                        <select id="outroStyle" class="input-box">
                                            <option value="ì¶”ì²œí˜•" selected>ì¶”ì²œí˜•</option>
                                            <option value="ë¬¼ìŒí‘œ ë§ˆë¬´ë¦¬í˜•">ë¬¼ìŒí‘œ ë§ˆë¬´ë¦¬í˜•</option>
                                            <option value="ì¥ì  ê°•ì¡° ë¬¼ìŒí˜•">ì¥ì  ê°•ì¡° ë¬¼ìŒí˜•</option>
                                            <option value="ë¬¼ìŒí‘œ ì¥ë‚œí˜•">ë¬¼ìŒí‘œ ì¥ë‚œí˜•</option>
                                            <option value="í–‰ë™ ìœ ë„í˜•">í–‰ë™ ìœ ë„í˜•</option>
                                            <option value="ë°˜ì „ í™•ì‹ í˜•">ë°˜ì „ í™•ì‹ í˜•</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button class="btn btn-primary btn-block" onclick="generateScripts()"
                                    id="generateScriptsBtn"
                                    style="width: 100%; padding: 1rem; font-size: 1.1rem; border-radius: 12px; margin-top: 1rem; font-weight: 700;">
                                    âœ¨ ëŒ€ë³¸ ìƒì„± ì‹œì‘
                                </button>
                            </div>

                            <!-- Results Area -->
                            <div id="scriptResultsArea" style="margin-top: 2rem; display: none;">
                                <h3 class="section-title">ğŸ“ ìƒì„±ëœ ëŒ€ë³¸ & ì˜¤ë””ì˜¤</h3>
                                <div id="generatedScriptsList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- left-column ë -->

            <!-- ì˜¤ë¥¸ìª½: ì„¤ì • ë° ìƒì„± -->
            <div class="right-column">



                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="section" id="inputSection">
                    <div class="section-title">ğŸ¬ ì˜ìƒ ì¥ë©´ êµ¬ì„±</div>

                    <div class="settings-grid"
                        style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-gray-200);">
                        <div class="setting-item">
                            <label>ì œëª©</label>
                            <input type="text" id="videoTitle" value="AI_Shorts" placeholder="ì˜ìƒ ì œëª©">
                            <div style="margin-top: 0.5rem; display: flex; align-items: center;">
                                <input type="checkbox" id="includeTitle" checked style="margin-right: 0.5rem;">
                                <label for="includeTitle"
                                    style="font-size: 0.9rem; color: var(--color-gray-700); cursor: pointer;">ì˜ìƒì— ì œëª©
                                    í¬í•¨í•˜ê¸°</label>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label>ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼</label>
                            <select id="imageStyle">
                                <option value="realistic">ì‹¤ì‚¬ (Realistic)</option>
                                <option value="anime">ì• ë‹ˆë©”ì´ì…˜ (Anime)</option>
                                <option value="cartoon">ì¹´íˆ° (Cartoon)</option>
                                <option value="comic">ë¯¸êµ­ ë§Œí™” (Comic)</option>
                                <option value="watercolor">ìˆ˜ì±„í™” (Watercolor)</option>
                                <option value="oil">ìœ í™” (Oil Painting)</option>
                                <option value="3d">3D ë Œë”ë§</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>ë°°ê²½ìŒì•…</label>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <select id="musicFolder" onchange="onMusicFolderChange()"
                                    style="flex: 1; padding: 0.6rem; border: 1px solid var(--color-gray-300); border-radius: 6px; font-size: 0.9rem;">
                                    <option value="">í´ë” ì„ íƒ</option>
                                </select>
                                <select id="musicFile" onchange="onMusicFileChange()"
                                    style="flex: 2; padding: 0.6rem; border: 1px solid var(--color-gray-300); border-radius: 6px; font-size: 0.9rem;">
                                    <option value="">ìŒì•… ì„ íƒ</option>
                                </select>
                            </div>
                            <!-- Mini Player -->
                            <div id="miniPlayer" class="mini-player" style="display: none;">
                                <button type="button" class="mini-player-btn" onclick="toggleMiniPlayer()"
                                    id="miniPlayerBtn">
                                    <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8 5v14l11-7z" />
                                    </svg>
                                    <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                                    </svg>
                                </button>
                                <div class="mini-player-info">
                                    <div class="mini-player-progress">
                                        <div class="mini-player-progress-bar" id="miniPlayerProgress"></div>
                                    </div>
                                    <span class="mini-player-time" id="miniPlayerTime">0:00 / 0:00</span>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="voiceEmotion" value="neutral">
                    </div>

                    <div class="template-buttons">
                        <button class="template-btn" onclick="loadTemplate('story')">ğŸ“– ìŠ¤í† ë¦¬ í…œí”Œë¦¿</button>
                        <button class="template-btn" onclick="loadTemplate('facts')">ğŸ’¡ íŒ©íŠ¸ í…œí”Œë¦¿</button>
                        <button class="template-btn" onclick="loadTemplate('tips')">âœ¨ íŒ í…œí”Œë¦¿</button>
                    </div>

                    <textarea id="jsonEditor" class="json-editor" placeholder='[
  {
    "text": "ì²« ë²ˆì§¸ ì¥ë©´ì—ì„œ ë‚˜ë ˆì´ì…˜í•  í…ìŠ¤íŠ¸",
    "imagePrompt": "DALL-Eì—ê²Œ ìš”ì²­í•  ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ (ì˜ì–´ ê¶Œì¥)"
  },
  {
    "text": "ë‘ ë²ˆì§¸ ì¥ë©´ í…ìŠ¤íŠ¸",
    "imagePrompt": "second scene image description"
  }
]'></textarea>

                    <div class="actions">
                        <button class="btn btn-secondary" onclick="validateJson()">êµ¬ì„± ë‚´ìš© í™•ì¸</button>
                        <button class="btn btn-primary" id="generateBtn" onclick="generateShorts()">
                            <span id="generateBtnText">ğŸ¬ ìˆí¼ ìƒì„±</span>
                            <span class="loading" id="generateLoading" style="display: none;"></span>
                        </button>
                    </div>
                </div>

                <!-- ì§„í–‰ ìƒíƒœ -->
                <div class="section progress-section" id="progressSection">
                    <div class="section-title">â³ ìƒì„± ì§„í–‰ ì¤‘...</div>

                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-status" id="progressStatus">ì¤€ë¹„ ì¤‘...</div>

                    <div class="progress-log" id="progressLog"></div>
                </div>

                <!-- ê²°ê³¼ -->
                <div class="section result-section" id="resultSection">
                    <div class="section-title">âœ… ìƒì„± ì™„ë£Œ!</div>

                    <video id="resultVideo" class="result-video" controls></video>

                    <div class="result-info" id="resultInfo"></div>

                    <div class="result-actions">
                        <button class="btn btn-secondary" onclick="resetForm()">ìƒˆë¡œ ë§Œë“¤ê¸°</button>
                        <a id="downloadLink" class="btn btn-primary" download>ğŸ“¥ ë‹¤ìš´ë¡œë“œ</a>
                    </div>
                </div>
            </div> <!-- right-column ë -->
        </div> <!-- main-row ë -->
    </div>

    <script>
        // ëŒ€ë³¸ ìƒì„±ê¸° ì˜ˆì‹œ ë°ì´í„°
        const scriptExamples = {
            story: [
                {
                    title: "ë§ˆë²• ì†Œë…€ì˜ ëª¨í—˜", script: [
                        { text: "ì˜›ë‚  ì˜›ì ì— ê¹Šì€ ìˆ² ì†ì— ì‘ì€ ë§ˆì„ì´ ìˆì—ˆìŠµë‹ˆë‹¤.", imagePrompt: "A small peaceful village in a deep magical forest, fairy tale style, soft lighting, Studio Ghibli inspired" },
                        { text: "ê·¸ ë§ˆì„ì—ëŠ” ë§ˆë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì†Œë…€ê°€ ì‚´ê³  ìˆì—ˆì–´ìš”.", imagePrompt: "A young girl with magical powers, glowing hands, wearing a cloak, fantasy art style" },
                        { text: "ì–´ëŠ ë‚ , ì†Œë…€ëŠ” ìˆ²ì—ì„œ ì‹ ë¹„ë¡œìš´ ìƒë¬¼ì„ ë§Œë‚˜ê²Œ ë©ë‹ˆë‹¤.", imagePrompt: "A mystical glowing creature in an enchanted forest, meeting a young girl, magical atmosphere" },
                        { text: "ê·¸ ìƒë¬¼ì´ ë§í–ˆì–´ìš”. ë„ˆë§Œì´ ì„¸ìƒì„ êµ¬í•  ìˆ˜ ìˆì–´.", imagePrompt: "Magical creature speaking to girl, dramatic lighting, fantasy scene, epic moment" }
                    ]
                },
                {
                    title: "ë°”ë‹¤ ì† ë¹„ë°€", script: [
                        { text: "ê¹Šì€ ë°”ë‹¤ ì†ì— ì•„ë¬´ë„ ëª¨ë¥´ëŠ” ì™•êµ­ì´ ìˆëŒ€ìš”.", imagePrompt: "Underwater magical kingdom, bioluminescent buildings, mermaids, beautiful ocean scene" },
                        { text: "ê·¸ê³³ì—ëŠ” ì²œ ë…„ì„ ì‚° ê±°ë¶ì´ ì™•ì´ ì‚´ê³  ìˆì–´ìš”.", imagePrompt: "Ancient wise turtle king with crown, underwater throne, majestic ocean palace" },
                        { text: "ê±°ë¶ì´ ì™•ì€ ì¸ê°„ì—ê²Œ ì¤‘ìš”í•œ ë©”ì‹œì§€ë¥¼ ì „í•˜ê³  ì‹¶ì—ˆëŒ€ìš”.", imagePrompt: "Turtle king looking up towards ocean surface, hopeful expression, dramatic underwater lighting" },
                        { text: "ë°”ë‹¤ë¥¼ ì§€ì¼œë‹¬ë¼ê³ ìš”.", imagePrompt: "Beautiful healthy ocean ecosystem, colorful coral reefs, marine life, conservation message" }
                    ]
                }
            ],
            facts: [
                {
                    title: "ìš°ì£¼ì—ì„œ ê°€ì¥ í° ë³„", script: [
                        { text: "ìš°ì£¼ì—ì„œ ê°€ì¥ í° ë³„ì´ ì–¼ë§ˆë‚˜ í°ì§€ ì•„ì„¸ìš”?", imagePrompt: "Vast universe with stars and galaxies, cosmic scale, awe-inspiring space photography style" },
                        { text: "ìŠ¤í‹°ë¸ìŠ¨ 2-18ì´ë¼ëŠ” ë³„ì¸ë°ìš”, íƒœì–‘ë³´ë‹¤ 2,150ë°° ì»¤ìš”.", imagePrompt: "Size comparison Stephenson 2-18 vs Sun, massive scale difference, space infographic style" },
                        { text: "ì´ ë³„ì„ íƒœì–‘ ìë¦¬ì— ë†“ìœ¼ë©´, í† ì„± ê¶¤ë„ê¹Œì§€ ì‚¼ì¼œë²„ë ¤ìš”.", imagePrompt: "Giant red star engulfing solar system up to Saturn, cosmic destruction scene" },
                        { text: "ê·¸ëŸ°ë° ìš°ì£¼ ì „ì²´ì—ì„œ ë³´ë©´, ì´ê²ƒë„ ë¨¼ì§€ë³´ë‹¤ ì‘ì•„ìš”.", imagePrompt: "Zooming out to show vast universe with billions of galaxies, humbling cosmic perspective" }
                    ]
                },
                {
                    title: "ì¸ê°„ ë‡Œì˜ ë¹„ë°€", script: [
                        { text: "ì¸ê°„ì˜ ë‡Œì— ëŒ€í•´ ì¶©ê²©ì ì¸ ì‚¬ì‹¤ ì•Œë ¤ë“œë¦´ê²Œìš”.", imagePrompt: "Human brain visualization, neural networks glowing, scientific medical illustration" },
                        { text: "ë‡Œì˜ 60%ê°€ ì§€ë°©ì´ì—ìš”. ê·¸ë˜ì„œ ì¢‹ì€ ì§€ë°©ì„ ë¨¹ì–´ì•¼ í•´ìš”.", imagePrompt: "Healthy brain foods, omega-3 rich foods, nuts, fish, avocado, colorful healthy diet" },
                        { text: "ê·¸ë¦¬ê³  ë‡ŒëŠ” í†µì¦ì„ ëŠë¼ì§€ ëª»í•´ìš”. í†µì¦ ìˆ˜ìš©ì²´ê°€ ì—†ê±°ë“ ìš”.", imagePrompt: "Cross-section of brain showing no pain receptors, medical educational illustration" },
                        { text: "ì‹ ê¸°í•˜ì§€ ì•Šì•„ìš”? ìš°ë¦¬ ë‡ŒëŠ” ì •ë§ ë¯¸ìŠ¤í„°ë¦¬ì˜ˆìš”.", imagePrompt: "Mysterious glowing brain with question marks, wonder and curiosity concept, magical" }
                    ]
                }
            ],
            motivation: [
                {
                    title: "ë©ˆì¶”ì§€ ë§ˆì„¸ìš”", script: [
                        { text: "ì§€ê¸ˆ í˜ë“œì‹ ê°€ìš”? í¬ê¸°í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?", imagePrompt: "Person sitting alone on mountain edge, contemplating, sunset, dramatic emotional scene" },
                        { text: "ê¸°ì–µí•˜ì„¸ìš”. ë‹¤ì´ì•„ëª¬ë“œë„ ì—„ì²­ë‚œ ì••ë ¥ì„ ë°›ì•„ì•¼ ë§Œë“¤ì–´ì ¸ìš”.", imagePrompt: "Diamond forming under pressure underground, glowing transformation process, dramatic" },
                        { text: "ì§€ê¸ˆ ê²ªëŠ” ì–´ë ¤ì›€ì´ ë°”ë¡œ ë‹¹ì‹ ì„ ë¹›ë‚˜ê²Œ ë§Œë“œëŠ” ê³¼ì •ì´ì—ìš”.", imagePrompt: "Person emerging from darkness into light, transformation metaphor, hopeful dramatic lighting" },
                        { text: "ë©ˆì¶”ì§€ ë§ˆì„¸ìš”. ëê¹Œì§€ ê°€ë©´ ë¶„ëª… ë¹›ë‚  ê±°ì˜ˆìš”.", imagePrompt: "Person standing victorious on mountain top, sunrise, golden light, triumphant pose" }
                    ]
                }
            ],
            horror: [
                {
                    title: "ì—˜ë¦¬ë² ì´í„°ì—ì„œ ìƒê¸´ ì¼", script: [
                        { text: "ìƒˆë²½ 3ì‹œ, í˜¼ì ì—˜ë¦¬ë² ì´í„°ë¥¼ íƒ”ì–´ìš”.", imagePrompt: "Empty elevator interior at 3am, flickering lights, horror atmosphere, creepy mood" },
                        { text: "5ì¸µì„ ëˆŒë €ëŠ”ë°, ì—˜ë¦¬ë² ì´í„°ê°€ 13ì¸µì—ì„œ ë©ˆì·„ì–´ìš”.", imagePrompt: "Elevator display showing floor 13, red ominous glow, horror movie style" },
                        { text: "ë¬¸ì´ ì—´ë ¸ëŠ”ë°, ë³µë„ì— ëˆ„êµ°ê°€ ì„œ ìˆì—ˆì–´ìš”. ë“±ì„ ë³´ì´ê³ ìš”.", imagePrompt: "Dark corridor view from elevator, mysterious figure standing with back turned, horror" },
                        { text: "ì²œì²œíˆ ê³ ê°œë¥¼ ëŒë¦¬ë”ë‹ˆ... ì›ƒê³  ìˆì—ˆì–´ìš”. ëˆˆì€ ì—†ëŠ”ë°.", imagePrompt: "Creepy figure turning around, eyeless face with wide smile, horror supernatural" }
                    ]
                }
            ],
            tips: [
                {
                    title: "ëª¨ê¸° í‡´ì¹˜ ê¿€íŒ", script: [
                        { text: "ì—¬ë¦„ë°¤ ëª¨ê¸° ë•Œë¬¸ì— ì  ëª» ìì‹œëŠ” ë¶„?", imagePrompt: "Person lying in bed annoyed by mosquito buzzing around, summer night, bedroom" },
                        { text: "ëª¨ê¸°ê°€ ì œì¼ ì‹«ì–´í•˜ëŠ” ê²Œ ë­”ì§€ ì•„ì„¸ìš”? ë°”ë¡œ ë ˆëª¬ í–¥ì´ì—ìš”.", imagePrompt: "Fresh lemons and lemon essential oil, bright clean aesthetic, natural mosquito repellent" },
                        { text: "ë ˆëª¬ì¦™ì„ í”¼ë¶€ì— ë°”ë¥´ë©´ ëª¨ê¸°ê°€ ì•ˆ ì™€ìš”. ì²œì—° ëª¨ê¸° í‡´ì¹˜ì œì˜ˆìš”.", imagePrompt: "Person applying natural lemon solution on arm, DIY mosquito repellent, helpful tip" },
                        { text: "ì˜¤ëŠ˜ ë°¤ë¶€í„° ê¿€ì  ìì„¸ìš”!", imagePrompt: "Person sleeping peacefully in bed, no mosquitoes, peaceful summer night" }
                    ]
                }
            ],
            korea: [
                {
                    title: "ì™¸êµ­ì¸ì´ ë†€ë€ í•œêµ­", script: [
                        { text: "ì™¸êµ­ì¸ë“¤ì´ í•œêµ­ ì™€ì„œ ì¶©ê²©ë°›ì€ ê²ƒë“¤ ì•Œë ¤ë“œë¦´ê²Œìš”.", imagePrompt: "Foreigner tourist amazed in Seoul, Korean cityscape, modern Korea, surprised expression" },
                        { text: "ì²«ì§¸, ë°°ë‹¬ ë¬¸í™”. ì‚°ê¼­ëŒ€ê¸°ì—ë„ ì¹˜í‚¨ì´ ì™€ìš”.", imagePrompt: "Korean delivery scooter on mountain, chicken delivery box, amazing Korean service" },
                        { text: "ë‘˜ì§¸, ì¸í„°ë„· ì†ë„. ì„¸ê³„ 1ìœ„ì˜ˆìš”. ì§€í•˜ì² ì—ì„œë„ ëŠê¹€ ì—†ì–´ìš”.", imagePrompt: "Fast internet speed visualization, 5G network, Seoul subway with people using phones" },
                        { text: "í•œêµ­ì¸ìœ¼ë¡œ íƒœì–´ë‚œ ê±° ì§„ì§œ ë³µì´ì—ìš”!", imagePrompt: "Proud Korean flag waving, beautiful Korea landscape, patriotic feeling" }
                    ]
                },
                {
                    title: "í•œêµ­ì´ ì„¸ê³„ 1ìœ„ì¸ ê²ƒë“¤", script: [
                        { text: "í•œêµ­ì´ ì„¸ê³„ 1ìœ„ì¸ ê±° ëª‡ ê°œë‚˜ ì•„ì„¸ìš”?", imagePrompt: "South Korea on world map glowing, number one, champion trophy" },
                        { text: "ì¸í„°ë„· ì†ë„ 1ìœ„, ë°˜ë„ì²´ ë©”ëª¨ë¦¬ 1ìœ„, ì¡°ì„  ì‚°ì—… 1ìœ„.", imagePrompt: "Korean technology achievements, semiconductors, ships, internet icons, infographic style" },
                        { text: "K-pop, K-ë“œë¼ë§ˆ, K-ë·°í‹°ê¹Œì§€. ë¬¸í™” ê°•êµ­ì´ì—ìš”.", imagePrompt: "K-pop idols, Korean drama scene, K-beauty products, cultural soft power" },
                        { text: "ëŒ€í•œë¯¼êµ­ êµ­ë¯¼ì¸ ê²Œ ìë‘ìŠ¤ëŸ½ì§€ ì•Šìœ¼ì„¸ìš”?", imagePrompt: "Korean flag with pride, celebrating Korea, patriotic moment, golden sunset" }
                    ]
                }
            ],
            international: [
                {
                    title: "êµ­ì œì»¤í”Œ ì¼ìƒ", script: [
                        { text: "êµ­ì œì»¤í”Œì˜ í˜„ì‹¤ ì•Œë ¤ë“œë¦´ê²Œìš”.", imagePrompt: "International couple, Korean person with foreign partner, happy couple, diverse love" },
                        { text: "ì–¸ì–´ ì¥ë²½? ì²˜ìŒì—” í˜ë“¤ì–´ìš”. ê·¼ë° ê·¸ë˜ì„œ ë” ë…¸ë ¥í•˜ê²Œ ë¼ìš”.", imagePrompt: "Couple struggling with language, translation app, but smiling, learning together" },
                        { text: "ë¬¸í™” ì°¨ì´ë„ ìˆì–´ìš”. ê·¼ë° ì„œë¡œ ë‹¤ë¥´ë‹ˆê¹Œ ë” ì¬ë¯¸ìˆì–´ìš”.", imagePrompt: "Cultural exchange, sharing different foods, celebrating different holidays, fun diversity" },
                        { text: "ì‚¬ë‘ì— êµ­ê²½ì€ ì—†ì–´ìš”!", imagePrompt: "International couple holding hands, world map background, love without borders, romantic" }
                    ]
                },
                {
                    title: "ì™¸êµ­ì¸ ì• ì¸ì´ ë†€ë€ í•œêµ­", script: [
                        { text: "ì™¸êµ­ì¸ ë‚¨ìì¹œêµ¬ê°€ í•œêµ­ ì™€ì„œ ì¶©ê²©ë°›ì•˜ëŒ€ìš”.", imagePrompt: "Foreign boyfriend surprised in Korea, amazed expression, Korean street scene" },
                        { text: "ì²«ì§¸, í¸ì˜ì . 24ì‹œê°„ì´ê³  ë­ë“  ìˆëŒ€ìš”.", imagePrompt: "Korean convenience store at night, variety of products, 24 hours sign" },
                        { text: "ë‘˜ì§¸, ì•ˆì „í•¨. ìƒˆë²½ì— í˜¼ì ë‹¤ë…€ë„ ë¬´ì„­ì§€ ì•ŠëŒ€ìš”.", imagePrompt: "Safe Korean street at night, peaceful atmosphere, safe walking alone" },
                        { text: "í•œêµ­ ì‚¬ëŠ” ê²Œ í–‰ìš´ì´ë˜ìš”!", imagePrompt: "Happy couple in Korea, enjoying Korean life, grateful expression, heart" }
                    ]
                }
            ]
        };
        let currentScriptTheme = 'story';

        // ëŒ€ë³¸ ìƒì„±ê¸° í† ê¸€
        // ëŒ€ë³¸ ìƒì„±ê¸° í† ê¸€ (í•­ìƒ í¼ì¹¨)
        /*
        document.getElementById('scriptGenToggle').addEventListener('click', () => {
            const content = document.getElementById('scriptGenContent');
            const icon = document.getElementById('scriptGenToggleIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = 'â–² ì ‘ê¸°';
                updateExampleScripts();
                updateScriptPrompt();
            } else {
                content.style.display = 'none';
                icon.textContent = 'â–¼ í¼ì¹˜ê¸°';
            }
        });
        */

        function selectTheme(theme) {
            currentScriptTheme = theme;
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.theme-btn[data-theme="${theme}"]`).classList.add('active');
            updateExampleScripts();
            updateScriptPrompt();
        }

        function updateExampleScripts() {
            const container = document.getElementById('exampleScripts');
            const examples = scriptExamples[currentScriptTheme] || [];
            container.innerHTML = examples.map((ex, i) => `
                <div class="example-card" onclick="applyScriptExample(${i})">
                    <div class="example-card-title">${ex.title}</div>
                    <div class="example-card-preview">${ex.script[0].text}</div>
                </div>
            `).join('');
        }

        function applyScriptExample(index) {
            const example = scriptExamples[currentScriptTheme][index];
            document.getElementById('jsonEditor').value = JSON.stringify(example.script, null, 2);
            alert('ëŒ€ë³¸ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function updateScriptPrompt() {
            const topic = document.getElementById('customScriptTopic').value || getDefaultScriptTopic();
            const prompt = `AIê°€ ê·¸ë¦¼ ê·¸ë¦¬ëŠ” ìœ íŠœë¸Œ ì‡¼ì¸  ë§Œë“¤ì–´ì¤˜

ì£¼ì œ: ${topic}

ì¡°ê±´:
- 4~5ê°œ ì¥ë©´ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
- ê° ì¥ë©´ë§ˆë‹¤ ì½ì„ ëŒ€ì‚¬ ì“°ê¸° (ì¹œê·¼í•œ ë§íˆ¬)
- ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ëŠ” ì˜ì–´ë¡œ ìƒì„¸í•˜ê²Œ

ì´ JSON í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜:
[
  {
    "text": "ì²« ë²ˆì§¸ ì¥ë©´ ëŒ€ì‚¬",
    "imagePrompt": "detailed scene description, cinematic, high quality"
  },
  {
    "text": "ë‘ ë²ˆì§¸ ì¥ë©´ ëŒ€ì‚¬",
    "imagePrompt": "scene description"
  }
]`;
            document.getElementById('scriptPromptPreview').value = prompt;
        }

        function getDefaultScriptTopic() {
            const topics = { story: 'ë§ˆë²•ì˜ ìˆ² ì´ì•¼ê¸°', facts: 'ìš°ì£¼ì˜ ì‹ ë¹„', motivation: 'í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”', horror: 'ì†Œë¦„ ë‹ëŠ” ì´ì•¼ê¸°', tips: 'ìƒí™œ ê¿€íŒ', korea: 'ì™¸êµ­ì¸ì´ ë†€ë€ í•œêµ­ì˜ ì¥ì ', international: 'êµ­ì œì»¤í”Œì˜ ì¼ìƒ' };
            return topics[currentScriptTheme] || 'ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”';
        }

        function copyScriptPrompt() {
            const prompt = document.getElementById('scriptPromptPreview').value;
            navigator.clipboard.writeText(prompt).then(() => alert('í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! AIì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”'));
        }

        // Templates
        const templates = {
            story: [
                {
                    text: "ì˜›ë‚  ì˜›ì ì— ê¹Šì€ ìˆ² ì†ì— ì‘ì€ ë§ˆì„ì´ ìˆì—ˆìŠµë‹ˆë‹¤.",
                    imagePrompt: "A small peaceful village in a deep magical forest, fairy tale style, soft lighting, Studio Ghibli inspired"
                },
                {
                    text: "ê·¸ ë§ˆì„ì—ëŠ” ë§ˆë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì†Œë…€ê°€ ì‚´ê³  ìˆì—ˆì–´ìš”.",
                    imagePrompt: "A young girl with magical powers, glowing hands, wearing a cloak, fantasy art style, beautiful detailed"
                },
                {
                    text: "ì–´ëŠ ë‚ , ì†Œë…€ëŠ” ìˆ²ì—ì„œ ì‹ ë¹„ë¡œìš´ ìƒë¬¼ì„ ë§Œë‚˜ê²Œ ë©ë‹ˆë‹¤.",
                    imagePrompt: "A mystical glowing creature in an enchanted forest, meeting a young girl, magical atmosphere, ethereal lighting"
                }
            ],
            facts: [
                {
                    text: "ìš°ì£¼ì—ì„œ ê°€ì¥ í° ë³„ì¸ ìŠ¤í‹°ë¸ìŠ¨ íˆ¬ë¹„ëŠ” íƒœì–‘ë³´ë‹¤ 2,150ë°°ë‚˜ í½ë‹ˆë‹¤.",
                    imagePrompt: "Comparison of Stephenson 2-18 star with our Sun, space infographic style, dramatic scale difference, cosmic background"
                },
                {
                    text: "ë§Œì•½ ì´ ë³„ì„ íƒœì–‘ ìë¦¬ì— ë†“ëŠ”ë‹¤ë©´, í† ì„± ê¶¤ë„ê¹Œì§€ ì‚¼ì¼œë²„ë¦´ ì •ë„ì…ë‹ˆë‹¤.",
                    imagePrompt: "Massive red hypergiant star engulfing Saturn's orbit, solar system scale comparison, scientific illustration"
                },
                {
                    text: "í•˜ì§€ë§Œ ì´ë ‡ê²Œ ê±°ëŒ€í•œ ë³„ë„ ìš°ì£¼ ì „ì²´ì—ì„œ ë³´ë©´ ë¨¼ì§€ë§Œí¼ ì‘ìŠµë‹ˆë‹¤.",
                    imagePrompt: "Zooming out from a star to reveal the vastness of the universe, galaxies and nebulas, humbling cosmic perspective"
                }
            ],
            tips: [
                {
                    text: "ì˜¤ëŠ˜ ì•Œë ¤ë“œë¦´ ìƒì‚°ì„± ê¿€íŒ ì²« ë²ˆì§¸!",
                    imagePrompt: "Productivity tips concept, clean modern desk setup, motivational atmosphere, bright and energetic style"
                },
                {
                    text: "ì•„ì¹¨ì— ì¼ì–´ë‚˜ìë§ˆì í•¸ë“œí°ì„ ë³´ì§€ ë§ˆì„¸ìš”. ëŒ€ì‹  ë¬¼ í•œ ì”ì„ ë§ˆì‹œì„¸ìš”.",
                    imagePrompt: "Person drinking water in the morning, avoiding phone, healthy morning routine, warm sunrise lighting"
                },
                {
                    text: "ì´ ì‘ì€ ìŠµê´€ì´ í•˜ë£¨ì˜ ì§‘ì¤‘ë ¥ì„ ì™„ì „íˆ ë°”ê¿”ì¤„ ê±°ì˜ˆìš”!",
                    imagePrompt: "Focused productive person working, clear mind visualization, achievement and success imagery, inspiring atmosphere"
                }
            ]
        };

        // Load template
        function loadTemplate(type) {
            const template = templates[type];
            if (template) {
                document.getElementById('jsonEditor').value = JSON.stringify(template, null, 2);
            }
        }

        // Load background music folders
        async function loadMusicFolders() {
            try {
                const response = await authFetch('/api/ai-shorts/music-folders');
                const data = await response.json();

                if (data.success && data.folders) {
                    const select = document.getElementById('musicFolder');
                    select.innerHTML = '<option value="">í´ë” ì„ íƒ</option>';
                    data.folders.forEach(f => {
                        const option = document.createElement('option');
                        option.value = f;
                        option.textContent = f;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading music folders:', error);
            }
        }

        async function onMusicFolderChange() {
            const folder = document.getElementById('musicFolder').value;
            const fileSelect = document.getElementById('musicFile');
            fileSelect.innerHTML = '<option value="">ìŒì•… ì„ íƒ</option>';

            if (!folder) return;

            try {
                const response = await authFetch(`/api/ai-shorts/music-files?folder=${encodeURIComponent(folder)}`);
                const data = await response.json();

                if (data.success && data.files) {
                    // Add Random Option
                    const randomOption = document.createElement('option');
                    randomOption.value = 'random';
                    randomOption.textContent = 'ğŸ² ëœë¤ (Random)';
                    fileSelect.appendChild(randomOption);

                    data.files.forEach(f => {
                        const option = document.createElement('option');
                        option.value = f;
                        option.textContent = f.replace(/\.[^/.]+$/, '');;
                        fileSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading music files:', error);
            }
        }

        // Validate JSON
        function validateJson() {
            const jsonText = document.getElementById('jsonEditor').value;
            try {
                const data = JSON.parse(jsonText);
                if (!Array.isArray(data)) {
                    alert('JSONì€ ë°°ì—´ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return false;
                }
                if (data.length === 0) {
                    alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì”¬ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return false;
                }
                for (let i = 0; i < data.length; i++) {
                    if (!data[i].text || !data[i].imagePrompt) {
                        alert(`ì”¬ ${i + 1}: textì™€ imagePromptëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.`);
                        return false;
                    }
                }
                alert(`âœ… JSON í˜•ì‹ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤! (${data.length}ê°œ ì”¬)`);
                return true;
            } catch (e) {
                alert('âŒ JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + e.message);
                return false;
            }
        }

        // Add log entry
        function addLog(message, type = 'info') {
            const log = document.getElementById('progressLog');
            const item = document.createElement('div');
            item.className = 'log-item ' + type;
            item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(item);
            log.scrollTop = log.scrollHeight;
        }

        // Update progress
        function updateProgress(percent, status) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressStatus').textContent = status;
        }

        // API í‚¤ ì„¤ì • ì—¬ë¶€ ì²´í¬
        async function checkApiKeyConfigured() {
            try {
                const response = await authFetch('/api/settings/keys');
                const data = await response.json();
                return data.success && data.keys?.AI_302_API_KEY;
            } catch (e) {
                return false;
            }
        }

        // API í‚¤ ë¯¸ì„¤ì • ì‹œ ì•ˆë‚´ íŒì—…
        function showApiKeyRequiredPopup() {
            const existingPopup = document.getElementById('apiKeyRequiredPopup');
            if (existingPopup) existingPopup.remove();

            const popup = document.createElement('div');
            popup.id = 'apiKeyRequiredPopup';
            popup.style.cssText = `position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000;`;
            popup.innerHTML = `
                <div style="background: var(--color-bg-secondary, #fff); border-radius: 16px; padding: 2rem; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”‘</div>
                    <h3 style="color: var(--color-gray-900, #333); margin-bottom: 0.75rem; font-size: 1.25rem;">302.AI API í‚¤ê°€ í•„ìš”í•´ìš”!</h3>
                    <p style="color: var(--color-gray-600, #666); font-size: 0.9rem; line-height: 1.6; margin-bottom: 1.5rem;">
                        AI ì‡¼ì¸ ë¥¼ ìƒì„±í•˜ë ¤ë©´ <strong>302.AI API í‚¤</strong>ê°€ í•„ìš”í•´ìš”.<br>
                        í•˜ë‚˜ì˜ í‚¤ë¡œ ëª¨ë“  AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        ì˜¤ë¥¸ìª½ ìœ„ ì„¤ì • ë²„íŠ¼ì„ ëˆŒëŸ¬ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!
                    </p>
                    <div style="display: flex; gap: 0.75rem; justify-content: center;">
                        <button onclick="this.closest('#apiKeyRequiredPopup').remove()" style="padding: 0.75rem 1.5rem; border: 1px solid var(--color-gray-300, #ddd); background: transparent; border-radius: 8px; cursor: pointer; font-size: 0.9rem; color: var(--color-gray-600, #666);">ë‹«ê¸°</button>
                        <button onclick="this.closest('#apiKeyRequiredPopup').remove(); openSettingsModal();" style="padding: 0.75rem 1.5rem; background: var(--color-primary, #3b82f6); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600;">ì„¤ì • ì—´ê¸°</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
            popup.addEventListener('click', (e) => { if (e.target === popup) popup.remove(); });
        }

        // Generate shorts
        async function generateShorts() {
            // API í‚¤ ì²´í¬
            const hasApiKey = await checkApiKeyConfigured();
            if (!hasApiKey) {
                showApiKeyRequiredPopup();
                return;
            }

            const jsonText = document.getElementById('jsonEditor').value;
            let scenes;

            try {
                scenes = JSON.parse(jsonText);
            } catch (e) {
                alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            if (!Array.isArray(scenes) || scenes.length === 0) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì”¬ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const title = document.getElementById('videoTitle').value || 'AI_Shorts';
            const style = document.getElementById('imageStyle').value;
            const emotion = document.getElementById('voiceEmotion').value;
            const musicFolder = document.getElementById('musicFolder').value;
            const musicFile = document.getElementById('musicFile').value;
            const bgMusic = null; // Unused in new logic
            const includeTitle = document.getElementById('includeTitle').checked;

            // Show progress section
            document.getElementById('inputSection').style.opacity = '0.5';
            document.getElementById('progressSection').classList.add('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('progressLog').innerHTML = '';

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            document.getElementById('generateBtnText').style.display = 'none';
            document.getElementById('generateLoading').style.display = 'inline-block';

            addLog(`ì‡¼ì¸  ìƒì„± ì‹œì‘: ${scenes.length}ê°œ ì”¬`);
            updateProgress(5, 'ì„œë²„ì— ìš”ì²­ ì¤‘...');

            try {
                const response = await authFetch('/api/ai-shorts/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        scenes,
                        title,
                        style,
                        emotion,
                        bgMusic,
                        musicFolder,
                        musicFile,
                        includeTitle
                    })
                });

                const data = await response.json();

                if (data.success) {
                    updateProgress(100, 'ì™„ë£Œ!');
                    addLog('âœ… ì‡¼ì¸  ìƒì„± ì™„ë£Œ!', 'success');

                    // Show result
                    document.getElementById('resultSection').classList.add('active');
                    document.getElementById('resultVideo').src = data.videoPath;
                    document.getElementById('downloadLink').href = data.videoPath;

                    document.getElementById('resultInfo').innerHTML = `
                        <p><strong>í”„ë¡œì íŠ¸:</strong> ${data.projectFolder}</p>
                        <p><strong>ì„±ê³µ:</strong> ${data.summary.successfulScenes}ê°œ ì”¬</p>
                        <p><strong>ì‹¤íŒ¨:</strong> ${data.summary.failedScenes}ê°œ ì”¬</p>
                    `;

                    // Log individual results
                    data.results.forEach(r => {
                        if (r.success) {
                            addLog(`ì”¬ ${r.scene}: ì„±ê³µ (${r.duration.toFixed(1)}ì´ˆ)`, 'success');
                        } else {
                            addLog(`ì”¬ ${r.scene}: ì‹¤íŒ¨ - ${r.error}`, 'error');
                        }
                    });
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                addLog('âŒ ì˜¤ë¥˜: ' + error.message, 'error');
                updateProgress(0, 'ì˜¤ë¥˜ ë°œìƒ');
                alert('ì‡¼ì¸  ìƒì„± ì‹¤íŒ¨: ' + error.message);
            } finally {
                generateBtn.disabled = false;
                document.getElementById('generateBtnText').style.display = 'inline';
                document.getElementById('generateLoading').style.display = 'none';
                document.getElementById('inputSection').style.opacity = '1';
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('progressSection').classList.remove('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('jsonEditor').value = '';
            document.getElementById('progressLog').innerHTML = '';
            updateProgress(0, '');
        }

        // Update prompt preview when topic changes
        function updatePromptPreview() {
            const topic = document.getElementById('promptTopic').value || '[ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”]';
            const prompt = `AIê°€ ê·¸ë¦¼ ê·¸ë¦¬ëŠ” ìœ íŠœë¸Œ ì‡¼ì¸  ë§Œë“¤ì–´ì¤˜

ì£¼ì œ: ${topic}

ì¡°ê±´:
- 3~5ê°œ ì¥ë©´ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
- ê° ì¥ë©´ë§ˆë‹¤ ì½ì„ ëŒ€ì‚¬ ì“°ê¸°
- ê·¸ë¦¼ ì„¤ëª…ì€ ì˜ì–´ë¡œ ìì„¸í•˜ê²Œ

ì´ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜:
[
  {
    "text": "ì²«ë²ˆì§¸ ì¥ë©´ì—ì„œ ì½ì„ ëŒ€ì‚¬",
    "imagePrompt": "first scene image, cinematic, beautiful"
  },
  {
    "text": "ë‘ë²ˆì§¸ ì¥ë©´ ëŒ€ì‚¬",
    "imagePrompt": "second scene description"
  }
]`;
            document.getElementById('promptPreview').value = prompt;
        }

        // Copy prompt from textarea
        function copyPromptFromTextarea() {
            const textarea = document.getElementById('promptPreview');
            navigator.clipboard.writeText(textarea.value).then(() => {
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! AIì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš” ğŸ˜Š');
            });
        }

        // Guide Modal Functions
        function openGuideModal() {
            document.getElementById('guideModal').style.display = 'flex';
        }

        function closeGuideModal() {
            document.getElementById('guideModal').style.display = 'none';
        }

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            icon.textContent = theme === 'dark' ? 'â˜€ï¸ ë¼ì´íŠ¸' : 'ğŸŒ™ ë‹¤í¬';
        }

        // Initialize theme
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                updateThemeIcon(savedTheme);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                updateThemeIcon('dark');
            }
        })();

        // Mini Player
        let miniPlayerAudio = null;
        let isMiniPlayerPlaying = false;

        function onMusicFileChange() {
            const folder = document.getElementById('musicFolder').value;
            const file = document.getElementById('musicFile').value;
            const miniPlayer = document.getElementById('miniPlayer');

            // Stop current audio if playing
            if (miniPlayerAudio) {
                miniPlayerAudio.pause();
                miniPlayerAudio = null;
                isMiniPlayerPlaying = false;
                updateMiniPlayerIcon();
            }

            if (folder && file && file !== 'random') {
                miniPlayer.style.display = 'flex';
                // Create new audio element with new static path
                miniPlayerAudio = new Audio(`/background-music/${encodeURIComponent(folder)}/${encodeURIComponent(file)}`);
                miniPlayerAudio.addEventListener('loadedmetadata', updateMiniPlayerTime);
                miniPlayerAudio.addEventListener('timeupdate', updateMiniPlayerProgress);
                miniPlayerAudio.addEventListener('ended', () => {
                    isMiniPlayerPlaying = false;
                    updateMiniPlayerIcon();
                    miniPlayerAudio.currentTime = 0;
                    updateMiniPlayerProgress();
                });
            } else {
                miniPlayer.style.display = 'none';
            }

            // Reset progress
            document.getElementById('miniPlayerProgress').style.width = '0%';
            document.getElementById('miniPlayerTime').textContent = '0:00 / 0:00';
        }

        function toggleMiniPlayer() {
            if (!miniPlayerAudio) return;

            if (isMiniPlayerPlaying) {
                miniPlayerAudio.pause();
            } else {
                miniPlayerAudio.play();
            }
            isMiniPlayerPlaying = !isMiniPlayerPlaying;
            updateMiniPlayerIcon();
        }

        function updateMiniPlayerIcon() {
            const btn = document.getElementById('miniPlayerBtn');
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            if (isMiniPlayerPlaying) {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
                btn.classList.add('playing');
            } else {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
                btn.classList.remove('playing');
            }
        }

        function updateMiniPlayerTime() {
            if (!miniPlayerAudio) return;
            const duration = miniPlayerAudio.duration || 0;
            document.getElementById('miniPlayerTime').textContent = `0:00 / ${formatTime(duration)}`;
        }

        function updateMiniPlayerProgress() {
            if (!miniPlayerAudio) return;
            const current = miniPlayerAudio.currentTime || 0;
            const duration = miniPlayerAudio.duration || 0;
            const percent = duration > 0 ? (current / duration) * 100 : 0;
            document.getElementById('miniPlayerProgress').style.width = percent + '%';
            document.getElementById('miniPlayerTime').textContent = `${formatTime(current)} / ${formatTime(duration)}`;
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Progress bar click to seek
        document.addEventListener('DOMContentLoaded', () => {
            const progressContainer = document.querySelector('.mini-player-progress');
            if (progressContainer) {
                progressContainer.addEventListener('click', (e) => {
                    if (!miniPlayerAudio || !miniPlayerAudio.duration) return;
                    const rect = progressContainer.getBoundingClientRect();
                    const percent = (e.clientX - rect.left) / rect.width;
                    miniPlayerAudio.currentTime = percent * miniPlayerAudio.duration;
                });
            }
        });

        // Init
        loadMusicFolders();
    </script>

    <style>
        .floating-menu {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 100;
        }

        .floating-menu-toggle {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary) 0%, #1d4ed8 100%);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .floating-menu-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }

        .floating-menu-toggle svg {
            width: 24px;
            height: 24px;
            transition: transform 0.3s ease;
        }

        .floating-menu.open .menu-icon {
            display: none;
        }

        .floating-menu.open .close-icon {
            display: block !important;
        }

        .floating-menu-items {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-end;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .floating-menu.open .floating-menu-items {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .floating-menu-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            white-space: nowrap;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            transform: translateX(20px);
            opacity: 0;
        }

        .floating-menu.open .floating-menu-item {
            transform: translateX(0);
            opacity: 1;
        }

        .floating-menu.open .floating-menu-item:nth-child(1) {
            transition-delay: 0.05s;
        }

        .floating-menu.open .floating-menu-item:nth-child(2) {
            transition-delay: 0.1s;
        }

        .floating-menu.open .floating-menu-item:nth-child(3) {
            transition-delay: 0.15s;
        }

        .floating-menu-item:hover {
            transform: translateX(-4px) !important;
        }

        .floating-menu-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .float-guide {
            background: var(--color-primary);
            color: white;
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
        }

        .float-telegram {
            background: #0088cc;
            color: white;
            box-shadow: 0 3px 10px rgba(0, 136, 204, 0.3);
        }

        .float-intro {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .floating-menu-backdrop {
            position: fixed;
            inset: 0;
            z-index: 99;
            display: none;
        }

        .floating-menu.open+.floating-menu-backdrop {
            display: block;
        }
    </style>

    <!-- Floating Menu -->
    <div class="floating-menu" id="floatingMenu">
        <div class="floating-menu-items">
            <button class="floating-menu-item float-guide" onclick="openGuideModal(); toggleFloatingMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                </svg>
                <span>ì‚¬ìš©ë²•</span>
            </button>
            <a href="https://t.me/shorts_factory" target="_blank" class="floating-menu-item float-telegram"
                onclick="toggleFloatingMenu();">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
                </svg>
                <span>ê³µì§€ì±„ë„</span>
            </a>
            <a href="https://shorts-factory-landing.web.app" target="_blank" class="floating-menu-item float-intro"
                onclick="toggleFloatingMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="12" y1="16" x2="12" y2="12" />
                    <line x1="12" y1="8" x2="12.01" y2="8" />
                </svg>
                <span>ì„œë¹„ìŠ¤ ì†Œê°œ</span>
            </a>
        </div>
        <button class="floating-menu-toggle" onclick="toggleFloatingMenu()" title="ë„ì›€ë§">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round" class="menu-icon">
                <circle cx="12" cy="12" r="10" />
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                <line x1="12" y1="17" x2="12.01" y2="17" />
            </svg>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round" class="close-icon" style="display:none;">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
        </button>
    </div>
    <div class="floating-menu-backdrop" onclick="toggleFloatingMenu()"></div>
    <script>
        function toggleFloatingMenu() {
            document.getElementById('floatingMenu').classList.toggle('open');
        }
    </script>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>API ì„¤ì •</h2>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- API í‚¤ ë°œê¸‰ ê°€ì´ë“œ -->
                <div
                    style="background: var(--color-bg-tertiary); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                    <h4 style="color: var(--color-gray-900); margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ”‘ 302.AI API
                        í‚¤ ì¤€ë¹„</h4>
                    <p
                        style="color: var(--color-gray-600); font-size: 0.85rem; line-height: 1.6; margin-bottom: 0.75rem;">
                        â€¢ í•˜ë‚˜ì˜ í‚¤ë¡œ ëª¨ë“  AI ëª¨ë¸ ì‚¬ìš©<br>
                        â€¢ GPT, Claude, Gemini, DALL-E, Whisper ë“± ì§€ì›<br>
                        â€¢ ì‚¬ìš©í•œ ë§Œí¼ë§Œ ê²°ì œ (ì¢…ëŸ‰ì œ)
                    </p>
                    <p style="color: var(--color-gray-500); font-size: 0.8rem; margin: 0;">
                        API í‚¤ëŠ” <a href="https://dash.302.ai/apis/markets" target="_blank"
                            style="color: var(--color-primary);">302.AI ëŒ€ì‹œë³´ë“œ</a>ì—ì„œ ë°œê¸‰í•˜ì„¸ìš”.
                    </p>
                </div>

                <div class="form-group">
                    <label for="ai302ApiKey">302.AI API Key</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="password" id="ai302ApiKey" placeholder="sk-..." style="flex: 1;">
                        <button class="btn btn-sm" onclick="toggleKeyVisibility('ai302ApiKey')">ğŸ‘ï¸</button>
                    </div>
                    <small style="color: var(--color-gray-500);">ì´ë¯¸ì§€ ìƒì„± (DALL-E)ê³¼ ëª¨ë“  AI ê¸°ëŠ¥ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</small>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center;">
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button class="btn" onclick="test302AIConnection()" id="test302AIBtn">302.AI í…ŒìŠ¤íŠ¸</button>
                            <span id="ai302TestResult" style="margin-left: 0.5rem;"></span>
                        </div>
                    </div>
                </div>

                <!-- í…Œë§ˆ ì„¤ì • -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--color-gray-200);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <label style="font-weight: 600; color: var(--color-gray-900);">í™”ë©´ í…Œë§ˆ</label>
                            <p style="font-size: 0.8rem; color: var(--color-gray-500); margin-top: 0.25rem;">ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œë¥¼
                                ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                        <button onclick="toggleTheme()" id="themeToggleBtn"
                            style="display: flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1rem; background: var(--color-bg-tertiary); border: 1px solid var(--color-gray-300); border-radius: 8px; cursor: pointer; font-size: 0.85rem; color: var(--color-gray-700); font-weight: 500;">
                            <span id="themeIcon">ğŸŒ™ ë‹¤í¬</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveSettings()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // Settings Modal Functions
        async function openSettingsModal() {
            document.getElementById('settingsModal').style.display = 'flex';
            document.getElementById('ai302TestResult').textContent = '';
            try {
                const response = await authFetch('/api/settings/keys');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('ai302ApiKey').placeholder = data.keys.AI_302_API_KEY || 'sk-...';
                }
            } catch (e) {
                console.error('Failed to load keys:', e);
            }
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
            document.getElementById('ai302ApiKey').value = '';
        }

        function toggleKeyVisibility(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        async function test302AIConnection() {
            const btn = document.getElementById('test302AIBtn');
            const result = document.getElementById('ai302TestResult');
            const apiKey = document.getElementById('ai302ApiKey').value;
            btn.disabled = true;
            result.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            result.style.color = 'var(--color-gray-500)';
            try {
                const response = await authFetch('/api/settings/test-302ai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey: apiKey || undefined })
                });
                const data = await response.json();
                if (data.success) {
                    result.textContent = 'âœ“ ì—°ê²° ì„±ê³µ!';
                    result.style.color = 'var(--color-success)';
                } else {
                    result.textContent = data.error || 'ì—°ê²° ì‹¤íŒ¨';
                    result.style.color = 'var(--color-error)';
                }
            } catch (e) {
                result.textContent = 'í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + e.message;
                result.style.color = 'var(--color-error)';
            }
            btn.disabled = false;
        }

        async function saveSettings() {
            const ai302Key = document.getElementById('ai302ApiKey').value.trim();
            if (!ai302Key) {
                alert('302.AI API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            try {
                const response = await authFetch('/api/settings/keys', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ AI_302_API_KEY: ai302Key })
                });
                const data = await response.json();
                if (data.success) {
                    alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeSettingsModal();
                    location.reload();
                } else {
                    alert('ì €ì¥ ì‹¤íŒ¨: ' + data.error);
                }
            } catch (e) {
                alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSettingsModal();
                closeGuideModal();
            }
        });

        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target.id === 'settingsModal') closeSettingsModal();
        });

        document.getElementById('guideModal').addEventListener('click', (e) => {
            if (e.target.id === 'guideModal') closeGuideModal();
        });
        // ==========================================
        //  Scripts from ai-video.html (Ported)
        // ==========================================

        // === ìŠ¤í¬ë¦½íŠ¸ ìŠ¤íƒ€ì¼ ì •ì˜ ===
        const scriptStyles = {
            review: { korean: "ë¦¬ë·°í˜•", english: "Review", description: "ê°œì¸ì ì¸ ë°©ë¬¸ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì§„ì†”í•œ ë¦¬ë·° ìŠ¤íƒ€ì¼" },
            promotional: { korean: "í™ë³´í˜•", english: "Promotional", description: "ë§¤ì¥ì˜ ì¥ì ì„ ê°•ì¡°í•˜ëŠ” ì§ì ‘ì ì¸ í™ë³´ ìŠ¤íƒ€ì¼" },
            storytelling: { korean: "ìŠ¤í† ë¦¬í…”ë§í˜•", english: "Storytelling", description: "ê°€ê²Œì˜ ìŠ¤í† ë¦¬ë‚˜ ì‚¬ì¥ë‹˜ì˜ ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ê°ì„± ìŠ¤íƒ€ì¼" },
            tips: { korean: "íŒ/ì¶”ì²œí˜•", english: "Tips", description: "ê¿€íŒì´ë‚˜ ì¶”ì²œ ë©”ë‰´ë¥¼ ì†Œê°œí•˜ëŠ” ì •ë³´ ì œê³µ ìŠ¤íƒ€ì¼" },
            urgency: { korean: "ê¸´ê¸‰/FOMOí˜•", english: "Urgency", description: "ì§€ê¸ˆ ê°€ì•¼ í•˜ëŠ” ì´ìœ ë¥¼ ê°•ì¡°í•˜ëŠ” ê¸´ë°•ê° ìˆëŠ” ìŠ¤íƒ€ì¼" },
            comparison: { korean: "ë¹„êµí˜•", english: "Comparison", description: "ë‹¤ë¥¸ ê³³ê³¼ ë¹„êµí•˜ë©° ì°¨ë³„ì ì„ ë¶€ê°í•˜ëŠ” ìŠ¤íƒ€ì¼" },
            question: { korean: "ì§ˆë¬¸í˜•", english: "Question", description: "ì‹œì²­ìì—ê²Œ ì§ˆë¬¸ì„ ë˜ì§€ë©° í˜¸ê¸°ì‹¬ì„ ìœ ë°œí•˜ëŠ” ìŠ¤íƒ€ì¼" }
        };

        const introStyles = {
            shocking: { korean: "ì¶©ê²©ì  ì‚¬ì‹¤í˜•", prompt: "Start with a shocking, surprising fact that makes viewers stop scrolling" },
            question: { korean: "ì§ˆë¬¸ ë˜ì§€ê¸°í˜•", prompt: "Begin with an engaging question that makes viewers curious" },
            surprise: { korean: "ë†€ëŒ í›„í¬í˜•", prompt: "Start with an exclamation of amazement or surprise" },
            local: { korean: "ì§€ì—­ ì¸ì¦í˜•", prompt: "Establish credibility by mentioning local recognition or popularity" },
            direct: { korean: "ì§ì„¤ì  ì†Œê°œí˜•", prompt: "Get straight to the point with a direct introduction" },
            visit: { korean: "ë°©ë¬¸ ì¸ì¦í˜•", prompt: "Start by verifying your visit to the location" }
        };

        const outroStyles = {
            question_mark: { korean: "ë¬¼ìŒí‘œ ë§ˆë¬´ë¦¬í˜•", prompt: "End with a teaser question that makes viewers curious about the location" },
            benefits: { korean: "ì¥ì  ê°•ì¡° ë¬¼ìŒí˜•", prompt: "Summarize key benefits and end with 'Where is this place?'" },
            playful: { korean: "ë¬¼ìŒí‘œ ì¥ë‚œí˜•", prompt: "End with a witty, playful question" },
            recommend: { korean: "ì¶”ì²œí˜•", prompt: "End with a strong, direct recommendation to visit" },
            cta: { korean: "í–‰ë™ ìœ ë„í˜•", prompt: "End with a clear call-to-action encouraging viewers to visit" },
            confident: { korean: "ë°˜ì „ í™•ì‹ í˜•", prompt: "End with confident confirmation that this is a genuine hidden gem" }
        };

        // === ì—”í„°í…Œì¸ë¨¼íŠ¸ ìŠ¤íƒ€ì¼ ì •ì˜ ===
        const entertainmentScriptStyles = {
            humor: { korean: "ìœ ë¨¸/ê°œê·¸", english: "Humor/Gag", description: "ì¬ë¯¸ìˆê³  ì›ƒê¸´ ìš”ì†Œê°€ ê°•ì¡°ëœ ìŠ¤íƒ€ì¼" },
            info: { korean: "ì •ë³´ì „ë‹¬", english: "Information", description: "ìœ ìš©í•œ ì •ë³´ë‚˜ ì‚¬ì‹¤ì„ ì „ë‹¬í•˜ëŠ” ìŠ¤íƒ€ì¼" },
            ranking: { korean: "ìˆœìœ„/ë­í‚¹", english: "Ranking/Top 5", description: "Top 5 ë“± ìˆœìœ„ë¥¼ ë§¤ê²¨ ì†Œê°œí•˜ëŠ” ìŠ¤íƒ€ì¼" },
            vlog: { korean: "ë¸Œì´ë¡œê·¸", english: "Vlog", description: "ì¼ìƒì ì¸ ì´ì•¼ê¸°ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í’€ì–´ë‚´ëŠ” ìŠ¤íƒ€ì¼" },
            reaction: { korean: "ë¦¬ì•¡ì…˜/í›„ê¸°", english: "Reaction", description: "ì° ë°˜ì‘ê³¼ ë¦¬ì–¼í•œ í›„ê¸°ë¥¼ ë‹´ì€ ìŠ¤íƒ€ì¼" },
            story: { korean: "ì°/ìŠ¤í† ë¦¬", english: "Story/Rumor", description: "í¥ë¯¸ì§„ì§„í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ëŠ” ìŠ¤íƒ€ì¼" }
        };

        const entertainmentIntroStyles = {
            hook: { korean: "ì‹œì„ ê°•íƒˆí˜•", english: "Hook/Attention", description: "ì´ˆë°˜ 3ì´ˆ ì•ˆì— ì‹œì„ ì„ í™• ë„ëŠ” ë¹„ì£¼ì–¼ì´ë‚˜ ë©˜íŠ¸" },
            curiosity: { korean: "ì§ˆë¬¸ìœ ë°œí˜•", english: "Question/Curiosity", description: "ê¶ê¸ˆì¦ì„ ìì•„ë‚´ëŠ” ì§ˆë¬¸ìœ¼ë¡œ ì‹œì‘" },
            conclusion: { korean: "ê²°ë¡ ì œì‹œí˜•", english: "Conclusion First", description: "ê²°ê³¼ë¬¼ì´ë‚˜ ê²°ë¡ ì„ ë¨¼ì € ë³´ì—¬ì£¼ê³  ì‹œì‘" },
            skit: { korean: "ìƒí™©ê·¹í˜•", english: "Situation/Skit", description: "ì§§ì€ ìƒí™©ê·¹ìœ¼ë¡œ ì¬ë¯¸ìˆê²Œ ì‹œì‘" }
        };

        const entertainmentOutroStyles = {
            subscribe: { korean: "êµ¬ë…/ì¢‹ì•„ìš” ìœ ë„", english: "Subscribe/Like", description: "êµ¬ë…ê³¼ ì¢‹ì•„ìš”ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ìš”ì²­" },
            next: { korean: "ë‹¤ìŒí™” ì˜ˆê³ ", english: "Next Episode", description: "ë‹¤ìŒ ë‚´ìš©ì„ ì˜ˆê³ í•˜ë©° ê¸°ëŒ€ê° ì¡°ì„±" },
            comment: { korean: "ëŒ“ê¸€ì°¸ì—¬ ìœ ë„", english: "Comment Question", description: "ì‹œì²­ìì˜ ì˜ê²¬ì„ ë¬»ëŠ” ì§ˆë¬¸ìœ¼ë¡œ ëŒ“ê¸€ ìœ ë„" },
            summary: { korean: "ìš”ì•½ì •ë¦¬", english: "Summary", description: "í•µì‹¬ ë‚´ìš©ì„ ì§§ê²Œ ìš”ì•½í•˜ë©° ë§ˆë¬´ë¦¬" }
        };

        // === ëŒ€ë³¸ ìƒì„±ê¸° í† ê¸€ ===
        function toggleScriptSection() {
            const content = document.getElementById('scriptSectionContent');
            const icon = document.getElementById('scriptSectionIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = 'â–²';
            } else {
                content.style.display = 'none';
                icon.textContent = 'â–¼';
            }
        }

        function toggleStyleChip(element) {
            element.classList.toggle('selected');
        }

        async function generateScripts() {
            const storeName = document.getElementById('storeName').value;
            const storeDescription = document.getElementById('storeDescription').value;
            const includeName = document.getElementById('includeName') ? document.getElementById('includeName').checked : false;
            const storeLocation = document.getElementById('storeLocation') ? document.getElementById('storeLocation').value : '';
            const locationIn = document.querySelector('input[name="locationIn"]:checked') ? document.querySelector('input[name="locationIn"]:checked').value : 'intro';

            const language = document.getElementById('scriptLanguage').value;
            const introStyle = document.getElementById('introStyle').value;
            const outroStyle = document.getElementById('outroStyle').value;

            // Get selected styles
            const selectedStyles = Array.from(document.querySelectorAll('#scriptStyleGrid .style-option-chip.selected'))
                .map(el => el.dataset.style);

            const mode = document.querySelector('input[name="scriptMode"]:checked') ? document.querySelector('input[name="scriptMode"]:checked').value : 'business';

            if (!storeName) {
                alert('ê°€ê²Œ ì´ë¦„(ë˜ëŠ” ì£¼ì œ)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (selectedStyles.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ëŒ€ë³¸ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const btn = document.getElementById('generateScriptsBtn');
            const originalText = btn.innerText;
            btn.innerText = 'â³ ëŒ€ë³¸ ìƒì„± ì¤‘...';
            btn.disabled = true;

            try {
                const response = await authFetch('/api/ai-video/generate-scripts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode,
                        restaurantName: storeName,
                        description: storeDescription,
                        includeRestaurantName: includeName,
                        location: storeLocation,
                        locationIn: locationIn,
                        styles: selectedStyles,
                        language: language,
                        introStyle: introStyle,
                        outroStyle: outroStyle
                    })
                });

                const data = await response.json();

                if (data.success) {
                    displayScriptResults(data.results);
                } else {
                    alert('ëŒ€ë³¸ ìƒì„± ì‹¤íŒ¨: ' + data.error);
                }
            } catch (error) {
                console.error('Script generation failed:', error);
                alert('ëŒ€ë³¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function displayScriptResults(results) {
            const container = document.getElementById('generatedScriptsList');
            const resultsArea = document.getElementById('scriptResultsArea');
            container.innerHTML = '';
            resultsArea.style.display = 'block';

            Object.entries(results).forEach(([style, script]) => {
                const id = `script_${Math.random().toString(36).substr(2, 9)}`;
                const div = document.createElement('div');
                div.className = 'script-result-card';
                div.innerHTML = `
                    <div class="script-result-header">
                        <span>ğŸ“Œ ${style}</span>
                        <button class="btn btn-sm btn-secondary" onclick="copyToClipboard('${id}')">ğŸ“‹ ë³µì‚¬</button>
                    </div>
                    <textarea id="${id}" style="width: 100%; min-height: 150px; padding: 0.5rem; border: 1px solid var(--color-gray-300); border-radius: 4px; font-size: 0.9rem; margin-bottom: 0.5rem;">${script}</textarea>
                    
                    <div class="audio-player-container">
                        <button class="btn btn-sm btn-primary" onclick="generateAudio('${id}', this)">ğŸ”Š ì˜¤ë””ì˜¤ ìƒì„± (TTS)</button>
                        <audio controls style="width: 100%; display: none; height: 35px; margin-left:10px;"></audio>
                    </div>
                `;
                container.appendChild(div);
            });

            // Scroll to results
            resultsArea.scrollIntoView({ behavior: 'smooth' });
        }

        async function generateAudio(textAreaId, btnElement) {
            let text = document.getElementById(textAreaId).value;
            const ttsProvider = document.getElementById('ttsProvider').value;
            const language = document.getElementById('scriptLanguage').value;

            // Clean text
            text = text.replace(/^(ì œëª©|Title):.*$/gm, '');
            text = text.replace(/^(ëŒ€ë³¸|Script):\s*/gm, '');
            text = text.trim();

            if (!text) {
                alert('ì¬ìƒí•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const originalText = btnElement.innerText;
            btnElement.innerText = 'â³ ìƒì„± ì¤‘...';
            btnElement.disabled = true;

            try {
                // í…ìŠ¤íŠ¸ì—ì„œ ì˜ë¯¸ ìˆëŠ” ì²« ë‹¨ì–´ë“¤ì„ ì œëª©ìœ¼ë¡œ ì¶”ì¶œ (ìµœëŒ€ 20ì)
                const meaningfulText = text.replace(/[^\w\sê°€-í£]/g, ' ').trim();
                const title = meaningfulText.slice(0, 20).trim() || 'ëŒ€ë³¸';

                const response = await authFetch('/api/ai-video/generate-tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        provider: ttsProvider,
                        language: language,
                        title: title
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const audio = btnElement.nextElementSibling; // The <audio> element
                    audio.src = data.audioPath;
                    audio.style.display = 'block';
                    audio.play();
                    // Hide button as requested
                    btnElement.style.display = 'none';
                } else {
                    alert('TTS ìƒì„± ì‹¤íŒ¨: ' + data.error);
                }
            } catch (error) {
                console.error('TTS failed:', error);
                alert('TTS ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                // Only reset if button is still visible
                if (btnElement.style.display !== 'none') {
                    btnElement.innerText = originalText;
                    btnElement.disabled = false;
                }
            }
        }

        function copyToClipboard(elementId) {
            const copyText = document.getElementById(elementId);
            copyText.select();
            document.execCommand("copy");
        }

        function toggleScriptMode() {
            const mode = document.querySelector('input[name="scriptMode"]:checked').value;
            const labelName = document.getElementById('labelName');
            const labelDesc = document.getElementById('labelDescription');
            const storeNameInput = document.getElementById('storeName');
            const storeDescInput = document.getElementById('storeDescription');
            const locGroup = document.getElementById('locationGroup');
            const labelDetail = document.getElementById('labelDetailInclude');

            if (mode === 'entertainment') {
                labelName.textContent = 'ğŸ¬ ì£¼ì œ / ì œëª©';
                storeNameInput.placeholder = 'ì˜ˆ: ì›ƒê¸´ ê³ ì–‘ì´ ëª¨ìŒ, ì—¬í–‰ ë¸Œì´ë¡œê·¸';

                labelDesc.textContent = 'ğŸ“ ì˜ìƒ ë‚´ìš© ì„¤ëª…';
                storeDescInput.placeholder = 'ì˜ˆ: ê³ ì–‘ì´ê°€ ì í”„í•˜ë‹¤ê°€ ë„˜ì–´ì§€ëŠ” ì¥ë©´, ì ìëŠ” ëª¨ìŠµ ë“± ê·€ì—¬ìš´ ìˆœê°„ë“¤ ëª¨ìŒì…ë‹ˆë‹¤.';

                if (labelDetail) labelDetail.textContent = 'ì œëª©';
                if (locGroup) locGroup.style.display = 'none'; // Hide location

                // Update Styles for Entertainment
                updateStyleOptions(entertainmentScriptStyles, entertainmentIntroStyles, entertainmentOutroStyles);
            } else {
                labelName.textContent = 'ğŸª ê°€ê²Œ ì´ë¦„';
                storeNameInput.placeholder = 'ì˜ˆ: ê³ ì–‘ì‹œ ë§›ì§‘ í• ë§¤ìˆœëŒ€êµ­';

                labelDesc.textContent = 'âœï¸ ê°€ê²Œ ì„¤ëª… / íŠ¹ì§•';
                storeDescInput.placeholder = 'ì˜ˆ: 40ë…„ ì „í†µì˜ ìˆœëŒ€êµ­ ì „ë¬¸ì ì…ë‹ˆë‹¤. êµ­ë¬¼ì´ ì§„í•˜ê³  ê³ ê¸°ê°€ ë§ì•„ìš”. 24ì‹œê°„ ì˜ì—…í•©ë‹ˆë‹¤.';

                if (labelDetail) labelDetail.textContent = 'ì´ë¦„';
                if (locGroup) locGroup.style.display = 'block'; // Show location

                // Update Styles for Business
                updateStyleOptions(scriptStyles, introStyles, outroStyles);
            }
        }

        function updateStyleOptions(sStyles, iStyles, oStyles) {
            // 1. Script Styles (Chips)
            const styleGrid = document.getElementById('scriptStyleGrid');
            if (!styleGrid) return;
            styleGrid.innerHTML = '';
            Object.values(sStyles).forEach(style => {
                const div = document.createElement('div');
                div.className = 'style-option-chip';
                div.textContent = style.korean;
                div.dataset.style = style.english; // Use English key for backend
                div.onclick = function () {
                    toggleStyleChip(this);
                    saveScriptInputs(); // Save on click
                };
                styleGrid.appendChild(div);
            });

            // 2. Intro Styles (Select)
            const introSelect = document.getElementById('introStyle');
            if (introSelect) {
                const currentIntro = introSelect.value;
                introSelect.innerHTML = '';
                Object.values(iStyles).forEach(style => {
                    const opt = document.createElement('option');
                    opt.value = style.korean;
                    opt.textContent = style.korean;
                    introSelect.appendChild(opt);
                });
                // Restore logic is better handled in loadScriptInputs or logic below
                // For now, reset to first or keep previous if valid
                if (Object.values(iStyles).some(s => s.korean === currentIntro)) {
                    introSelect.value = currentIntro;
                } else {
                    introSelect.selectedIndex = 0;
                }
            }

            // 3. Outro Styles (Select)
            const outroSelect = document.getElementById('outroStyle');
            if (outroSelect) {
                const currentOutro = outroSelect.value;
                outroSelect.innerHTML = '';
                Object.values(oStyles).forEach(style => {
                    const opt = document.createElement('option');
                    opt.value = style.korean;
                    opt.textContent = style.korean;
                    outroSelect.appendChild(opt);
                });
                if (Object.values(oStyles).some(s => s.korean === currentOutro)) {
                    outroSelect.value = currentOutro;
                } else {
                    outroSelect.selectedIndex = 0;
                }
            }
        }

        // === Input Persistence ===
        function saveScriptInputs() {
            const inputs = {
                scriptMode: document.querySelector('input[name="scriptMode"]:checked')?.value,
                storeName: document.getElementById('storeName').value,
                includeName: document.getElementById('includeName').checked,
                storeLocation: document.getElementById('storeLocation').value,
                locationIn: document.querySelector('input[name="locationIn"]:checked')?.value,
                storeDescription: document.getElementById('storeDescription').value,
                scriptLanguage: document.getElementById('scriptLanguage').value,
                introStyle: document.getElementById('introStyle').value,
                outroStyle: document.getElementById('outroStyle').value,
                ttsProvider: document.getElementById('ttsProvider').value,
                selectedStyles: Array.from(document.querySelectorAll('#scriptStyleGrid .style-option-chip.selected'))
                    .map(el => el.dataset.style)
            };
            localStorage.setItem('scriptGenInputs', JSON.stringify(inputs));
        }

        function loadScriptInputs() {
            const saved = localStorage.getItem('scriptGenInputs');
            if (!saved) return;

            try {
                const inputs = JSON.parse(saved);

                // Mode
                if (inputs.scriptMode) {
                    const modeRadio = document.querySelector(`input[name="scriptMode"][value="${inputs.scriptMode}"]`);
                    if (modeRadio) {
                        modeRadio.checked = true;
                        toggleScriptMode(); // This refreshes fields and options
                    }
                }

                // Text fields
                if (inputs.storeName) document.getElementById('storeName').value = inputs.storeName;
                if (inputs.storeDescription) document.getElementById('storeDescription').value = inputs.storeDescription;
                if (inputs.storeLocation) document.getElementById('storeLocation').value = inputs.storeLocation;

                // Checks
                if (inputs.includeName !== undefined) document.getElementById('includeName').checked = inputs.includeName;
                if (inputs.locationIn) {
                    const locRadio = document.querySelector(`input[name="locationIn"][value="${inputs.locationIn}"]`);
                    if (locRadio) locRadio.checked = true;
                }

                // Selects
                if (inputs.scriptLanguage) document.getElementById('scriptLanguage').value = inputs.scriptLanguage;
                if (inputs.ttsProvider) document.getElementById('ttsProvider').value = inputs.ttsProvider;

                // Intro/Outro styles might need to be set after updateStyleOptions ensures they exist
                if (inputs.introStyle) {
                    const el = document.getElementById('introStyle');
                    if (el && Array.from(el.options).some(o => o.value === inputs.introStyle)) el.value = inputs.introStyle;
                }
                if (inputs.outroStyle) {
                    const el = document.getElementById('outroStyle');
                    if (el && Array.from(el.options).some(o => o.value === inputs.outroStyle)) el.value = inputs.outroStyle;
                }

                // Style Chips
                if (inputs.selectedStyles && Array.isArray(inputs.selectedStyles)) {
                    const chips = document.querySelectorAll('#scriptStyleGrid .style-option-chip');
                    chips.forEach(chip => {
                        if (inputs.selectedStyles.includes(chip.dataset.style)) {
                            chip.classList.add('selected');
                        } else {
                            chip.classList.remove('selected');
                        }
                    });
                }

            } catch (e) {
                console.error("Failed to load script inputs", e);
            }
        }

        // Initialize script mode on load
        document.addEventListener('DOMContentLoaded', () => {
            // Only if the elements exist (they should now)
            if (document.querySelector('input[name="scriptMode"]')) {
                // First load stored mode to set correct fields
                const saved = localStorage.getItem('scriptGenInputs');
                if (saved) {
                    loadScriptInputs();
                } else {
                    toggleScriptMode();
                }

                // Add event listeners for auto-save
                const inputs = [
                    'storeName', 'storeDescription', 'storeLocation',
                    'includeName', 'scriptLanguage', 'introStyle', 'outroStyle', 'ttsProvider'
                ];
                inputs.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('change', saveScriptInputs);
                    if (el) el.addEventListener('input', saveScriptInputs);
                });

                document.querySelectorAll('input[name="scriptMode"], input[name="locationIn"]').forEach(el => {
                    el.addEventListener('change', saveScriptInputs);
                });
            }
        });

    </script>

    <!-- Firebase Auth -->
    <script src="/js/firebase-config.js"></script>
    <script src="/js/firebase-auth.js"></script>
    <script>
        // Check authentication
        requireAuth().then(authState => {
            if (authState) {
                document.body.style.visibility = 'visible';
                startTokenRefresh();

                // Update header auth UI
                setHeaderAuthState(authState);

                // Add admin link if user is admin
                if (authState.isAdmin) {
                    const nav = document.querySelector('.header-nav');
                    if (nav && !nav.querySelector('[href="/admin"]')) {
                        const adminLink = document.createElement('a');
                        adminLink.href = '/admin';
                        adminLink.innerHTML = '<span>ê´€ë¦¬ì</span>';
                        nav.appendChild(adminLink);
                    }
                }
            }
        });
    </script>
</body>

</html>